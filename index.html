<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>YM2151 Web Test</title>
</head>
<body>
    <h1>YM2151 Sine Wave Test</h1>
    <button onclick="playSine()">Play Sine Wave</button>

    <script>
        let audioContext;

        var Module = {
            onRuntimeInitialized: function() {
                console.log("Emscripten ready!");
            }
        };

        function playSine() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            console.log("Generating sine wave...");
            
            const numSamples = Module._generate_sine();
            console.log("Generated samples:", numSamples);
            
            const buffer = new Float32Array(numSamples);
            for (let i = 0; i < numSamples; i++) {
                buffer[i] = Module._get_sample(i);
            }
            
            console.log("First 10 samples:", Array.from(buffer.slice(0, 10)));
            
            const audioBuffer = audioContext.createBuffer(1, numSamples, 44100);
            audioBuffer.getChannelData(0).set(buffer);
            
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(audioContext.destination);
            source.start();
            
            console.log("Playing...");
            
            Module._free_buffer();
        }
    </script>
    
    <script src="sine_test.js"></script>
</body>
</html>
